
# 开发日志
待办开发工作：
- **（已完成）** 完整的指导语。
- **（已完成）** 正式测验材料（写死或自动生成）。 
- **（已完成）** datafile 优化数据格式，检验分数计算逻辑。
- **（已完成）** 针对双人实验，重构 kernel 等相关模块。
    - 3显示器（主试 monitor 1，被试 monitor 2 / 3）
    - 1键盘（主试控制）+ 2手柄（被试控制）
- fNIRS 联调（需联系学部实验室）。

## 已知 bug
- **（已修复）** 单方翻页后，后端的 GS 打印出来的结果是更新的，但前端显式渲染的图形是同一张图。
- **（已修复）** 单方翻页后，另一方的形状和颜色选择器会被初始化。
- **（已修复）** 有时翻页会出现问题：
        line 410, in render_hud
            `pos=self.graph_pos[selected_shape_index])`
- **（已修复）** 单方完成后，翻页会闪退。
        解决方案：修改 line 182 附近的逻辑。
        line 209, in page_coloring
            `self.render_graph(GS=GraphSeries(*gs_stage[stage][gs_order[self.current_page[2]]]['uncolored'],`
        IndexError: list index out of range
- **（已修复）** 单方的 `.page_coloring` 结束时，会持续显示白屏，没有文字信息。
- **（已修复）** 双方的 `.page_coloring` 结束时，主试机会显示黑屏（`.intermezzo`方法）但没有文字，随后退出。实验记录表明为正常退出。
- **（已修复）** sub2 先完成的时候 sub1 的窗口会白屏，任意操作后恢复，但之后每次切换会出现页面闪烁。
- **（已修复）** `intermezzo` 在主试机上没有渲染出文字。

## 数据结构

列字段：

sys_time,exp_num,exp_cfg,gender_sub1,age_sub1,gender_sub2,age_sub2,exp_time,
lable,sub_id,gs_id,score_total,score_a,score_b,notes

## 概要

- 图形序列由6个或8个图形构成，其中包含2个未填色的图形。
- 最优的填色方案不止一种，但同时涉及A类和B类规则。
- 双方学习的A类、B类规则互不交叉，各6条（3A+3B）。
- A类规则通过图形形式呈现；B类规则通过图文形式呈现。

## 学习材料（阶段1）

| 序号 | A类 / 形状种类数量～颜色种类数量 | B类 / 颜色种类数量～颜色组合形式 |
| --- | ----------------------------------- | ----------------------------------- |
| 01 | 5个图形 3种形状 填入3种颜色 | 5个图形 2种颜色 0红+0绿+0蓝+3黄+2紫 |
| 02 | 5个图形 4种形状 填入2种颜色 | 5个图形 3种颜色 0红+1绿+0蓝+2黄+2紫 |
| 03 | 5个图形 5种形状 填入4种颜色 | 5个图形 4种颜色 1红+1绿+0蓝+2黄+1紫 |
| 04 | 6个图形 3种形状 填入2种颜色 | 6个图形 2种颜色 3红+0绿+3蓝+0黄+0紫 |
| 05 | 6个图形 4种形状 填入4种颜色 | 6个图形 3种颜色 2红+0绿+3蓝+0黄+1紫 |
| 06 | 6个图形 5种形状 填入3种颜色 | 6个图形 4种颜色 2红+0绿+2蓝+1黄+1紫 |
| 07 | 7个图形 3种形状 填入3种颜色 | 7个图形 2种颜色 0红+3绿+0蓝+4黄+0紫 |
| 08 | 7个图形 4种形状 填入4种颜色 | 7个图形 3种颜色 1红+2绿+0蓝+4黄+0紫 |
| 09 | 7个图形 5种形状 填入2种颜色 | 7个图形 4种颜色 1红+2绿+1蓝+3黄+0紫 |
| 10 | 8个图形 3种形状 填入4种颜色 | 8个图形 2种颜色 0红+5绿+0蓝+0黄+3紫 |
| 11 | 8个图形 4种形状 填入2种颜色 | 8个图形 3种颜色 0红+4绿+1蓝+0黄+3紫 |
| 12 | 8个图形 5种形状 填入3种颜色 | 8个图形 4种颜色 1红+4绿+1蓝+0黄+2紫 |

## 学习材料（阶段2）

| 序号 | A类 / 形状种类数量～颜色种类数量 | B类 / 颜色种类数量～颜色组合形式 |
| --- | ----------------------------------- | ----------------------------------- |
| 01 | 5个图形 3种形状 填入4种颜色 | 5个图形 2种颜色 1红+0绿+0蓝+0黄+4紫 |
| 02 | 5个图形 4种形状 填入3种颜色 | 5个图形 3种颜色 1红+0绿+0蓝+1黄+3紫 |
| 03 | 5个图形 5种形状 填入2种颜色 | 5个图形 4种颜色 1红+1绿+0蓝+1黄+2紫 |
| 04 | 6个图形 3种形状 填入3种颜色 | 6个图形 2种颜色 0红+4绿+0蓝+2黄+0紫 |
| 05 | 6个图形 4种形状 填入4种颜色 | 6个图形 3种颜色 0红+3绿+0蓝+2黄+1紫 |
| 06 | 6个图形 5种形状 填入2种颜色 | 6个图形 4种颜色 0红+2绿+1蓝+2黄+1紫 |
| 07 | 7个图形 3种形状 填入3种颜色 | 7个图形 2种颜色 0红+0绿+3蓝+4黄+0紫 |
| 08 | 7个图形 4种形状 填入2种颜色 | 7个图形 3种颜色 0红+1绿+3蓝+3黄+0紫 |
| 09 | 7个图形 5种形状 填入4种颜色 | 7个图形 4种颜色 1红+1绿+2蓝+3黄+0紫 |
| 10 | 8个图形 3种形状 填入2种颜色 | 8个图形 2种颜色 4红+0绿+4蓝+0黄+0紫 |
| 11 | 8个图形 4种形状 填入3种颜色 | 8个图形 3种颜色 3红+0绿+4蓝+1黄+0紫 |
| 12 | 8个图形 5种形状 填入4种颜色 | 8个图形 4种颜色 2红+0绿+4蓝+1黄+1紫 |

## 测验材料

| 阶段 | 测验题目呈现（不含形状）    | 规则类型                       |
| --- | ----------------------- | ----------------------------- |
| 1   | 5个图形 3种形状 **2黄1紫** | 0红+1绿+0蓝+2黄+2紫            |
|     | 5个图形 4种形状 **2黄1紫** | 0红+0绿+0蓝+3黄+2紫            |
|     | 5个图形 5种形状 **2黄1紫** | 1红+1绿+0蓝+2黄+1紫            |
|     | 6个图形 3种形状 **2红2蓝** | 3红+0绿+3蓝+0黄+0紫            |
|     | 6个图形 4种形状 **2红2蓝** | 2红+0绿+2蓝+1黄+1紫            |
|     | 6个图形 5种形状 **2红2蓝** | 2红+0绿+3蓝+0黄+1紫            |
|     | 7个图形 3种形状 **2绿3黄** | 1红+2绿+0蓝+4黄+0紫            |
|     | 7个图形 4种形状 **2绿3黄** | 1红+2绿+1蓝+3黄+0紫            |
|     | 7个图形 5种形状 **2绿3黄** | 0红+3绿+0蓝+4黄+0紫            |
|     | 8个图形 3种形状 **4绿2紫** | 1红+4绿+1蓝+0黄+2紫            |
|     | 8个图形 4种形状 **4绿2紫** | 0红+5绿+0蓝+0黄+3紫            |
|     | 8个图形 5种形状 **4绿2紫** | 0红+4绿+1蓝+0黄+3紫            |
| 2   | 5个图形 3种形状 **1红2紫** | 1红+1绿+0蓝+1黄+2紫            |
|     | 5个图形 4种形状 **1红2紫** | 1红+0绿+0蓝+1黄+3紫            |
|     | 5个图形 5种形状 **1红2紫** | 1红+0绿+0蓝+0黄+4紫            |
|     | 6个图形 3种形状 **2绿2黄** | 0红+3绿+0蓝+2黄+1紫            |
|     | 6个图形 4种形状 **2绿2黄** | 0红+2绿+1蓝+2黄+1紫            |
|     | 6个图形 5种形状 **2绿2黄** | 0红+4绿+0蓝+2黄+0紫            |
|     | 7个图形 3种形状 **2蓝3黄** | 0红+1绿+3蓝+3黄+0紫            |
|     | 7个图形 4种形状 **2蓝3黄** | 0红+0绿+3蓝+4黄+0紫            |
|     | 7个图形 5种形状 **2蓝3黄** | 1红+1绿+2蓝+3黄+0紫            |
|     | 8个图形 3种形状 **2红4蓝** | 4红+0绿+4蓝+0黄+0紫            |
|     | 8个图形 4种形状 **2红4蓝** | 3红+0绿+4蓝+1黄+0紫            |
|     | 8个图形 5种形状 **2红4蓝** | 2红+0绿+4蓝+1黄+1紫            |
